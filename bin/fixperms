#!/usr/bin/env bash
# Fix file permissions in the container
# Usage: bin/fixperms [path]
# Example: bin/fixperms var

set -e

SCRIPT_DIR="$(cd "$(dirname "$0")" && pwd)"
PROJECT_ROOT="$(cd "${SCRIPT_DIR}/.." && pwd)"
cd "${PROJECT_ROOT}"

echo "ðŸ”§ Fixing filesystem permissions..."

if [ -z "$1" ]; then
    "${SCRIPT_DIR}/clinotty" find var vendor pub/static pub/media app/etc \( -type f -or -type d \) -exec chmod u+w {} + 2>/dev/null || true
    "${SCRIPT_DIR}/clinotty" chmod u+x bin/magento 2>/dev/null || true
else
    "${SCRIPT_DIR}/clinotty" find "$1" \( -type f -or -type d \) -exec chmod u+w {} + 2>/dev/null || true
fi

echo "âœ… Filesystem permissions fixed."
