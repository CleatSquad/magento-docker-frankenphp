#!/usr/bin/env bash
# Start Docker containers
# Usage: bin/start

set -e

SCRIPT_DIR="$(cd "$(dirname "$0")" && pwd)"
PROJECT_ROOT="$(cd "${SCRIPT_DIR}/.." && pwd)"
cd "${PROJECT_ROOT}"

# If .env is missing, run bin/setup
if [ ! -f ".env" ]; then
    echo "âš™ï¸  .env not found â€” running bin/setup..."
    if [ -x "bin/setup" ]; then
        if bin/setup; then
            echo "âœ… bin/setup completed"
        else
            echo "âš ï¸  bin/setup failed"
        fi
    elif [ -f "bin/setup" ]; then
        echo "âš ï¸  bin/setup is not executable, running with bash..."
        if bash bin/setup; then
            echo "âœ… bin/setup completed"
        else
            echo "âš ï¸  bin/setup failed"
        fi
    else
        echo "â„¹ï¸  bin/setup not found, skipping"
    fi
fi

echo "ğŸš€ Starting Docker containers..."
docker compose up -d --remove-orphans "$@"
echo "âœ… Containers started successfully!"

# Show status
echo ""
echo "ğŸ“Š Container status:"
docker compose ps
