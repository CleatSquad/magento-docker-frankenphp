#!/usr/bin/env bash
# Copy files from container to host
# Usage: bin/copyfromcontainer <path>
# Example: bin/copyfromcontainer vendor

set -e

SCRIPT_DIR="$(cd "$(dirname "$0")" && pwd)"
PROJECT_ROOT="$(cd "${SCRIPT_DIR}/.." && pwd)"
cd "${PROJECT_ROOT}"

[ -z "$1" ] && echo "Please specify a directory or file to copy from container (ex. vendor, --all)" && exit 1

REAL_SRC="${PROJECT_ROOT}/src"

# Ensure src directory exists
if [ ! -d "$REAL_SRC" ]; then
    mkdir -p "$REAL_SRC"
fi

CONTAINER_ID=$(docker compose ps -q app | head -n 1)

if [ "$1" == "--all" ]; then
    docker cp "${CONTAINER_ID}":/var/www/html/. "$REAL_SRC/"
    echo "✅ Completed copying all files from container to host"
else
    if [ -f "$1" ]; then
        docker cp "${CONTAINER_ID}":/var/www/html/"$1" "$REAL_SRC/$1"
    else
        docker cp "${CONTAINER_ID}":/var/www/html/"$1" "$REAL_SRC/$(dirname "$1")"
    fi
    echo "✅ Completed copying $1 from container to host"
fi
